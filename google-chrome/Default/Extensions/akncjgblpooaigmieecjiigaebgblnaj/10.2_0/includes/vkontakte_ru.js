!function(e){function t(t){for(var r,i,s=t[0],l=t[1],u=t[2],d=0,p=[];d<s.length;d++)i=s[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&p.push(a[i][0]),a[i]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);for(c&&c(t);p.length;)p.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,s=1;s<n.length;s++){var l=n[s];0!==a[l]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},a={17:0},o=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var s=window.savefromContentScriptWebpackJsonp=window.savefromContentScriptWebpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var c=l;o.push([121,0]),n()}({121:function(e,t,n){"use strict";n.r(t);var r=n(14),a=n(20),o=n(10),i=n(4),s=n(2),l=n.n(s),u=n(0),c=n(16),d=n(25),p=n(38),f=n(37),h=n(35),m=n(33),v=n(49),g=n(21),b=n(31),k=n(26),y=n(63),w=n(42),_=n(30),x=n(8),O=n(3),S=n(65),L=n(11),M=n(19),A=n(12),j=n(28),P=n(18),C=n(45),N=n(51),I=n(57),q=n(64),D=n(24),B=n(54),F=n(55),R=n(1),T=n(27),E=n(9),H=n(39);function V(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z=Object(c.a)({}).svg.getSrc("download","#4986cc","20px"),W=R.c.memo((function(e){var t=e.iframeSrc,n=R.c.useState([]),r=Object(o.a)(n,2),a=r[0],i=r[1];return R.c.useEffect((function(){Object(M.a)({action:"showjetFetchMovie",iframeVideoURL:t}).then((function(e){e=e.map((function(e){return U(U({},e),{},{onClick:function(){Object(T.a)(Object(E.e)(H.a,{filename:L.a.modify(e.filename)+".mp4",format:"mp4",sources:[{url:e.endpoint,format:"mp4"}],convertType:"hls"}),"sf-muxer-parent")}})})),i(e)}))}),[]),R.c.createElement(F.b,{items:a,theme:F.d},R.c.createElement(F.a,null,R.c.createElement("div",{className:"like_btn",style:{marginLeft:"14px"}},R.c.createElement("img",{src:z,style:{opacity:.5},alt:""}),R.c.createElement("div",{className:"like_button_label"},u.a.i18n.getMessage("download")))))})),J=n(60),X=n(15),$=n(29),K=n(17);function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Q=n(48),Z=Object(A.a)("vkontakte_ru"),ee=navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome");j.a.isSingle()&&Object(d.b)("vk",(function(e,t){var n=Object(c.a)(t),r=t.preferences,s=r.moduleVkontakte?1:0,d=u.a.isChrome||u.a.isFirefox||u.a.isGM&&u.a.isTM,A=Object(p.a)(),j=!1;if(A)if(/\/video_ext\.php\?.+/.test(location.href))j=!0;else{if(!/\/widget_comments\.php\?.+/.test(location.href))return;A=!1}u.a.onMessage.addListener((function(t,n,a){if("getModuleInfo"===t.action){if(t.url!==location.href)return;return a({state:s,moduleName:e})}if("changeState"===t.action){if(e!==t.moduleName)return;return re.changeState(t.state)}"updatePreferences"!==t.action?s&&("updateLinks"===t.action&&oe(),"downloadMP3Files"===t.action&&(d?ce.downloadMP3Files():ce.showListOfAudioFiles(!1)),"downloadPlaylist"===t.action&&ce.showListOfAudioFiles(!0),"downloadPhotos"===t.action&&fe.downloadPhoto()):Object.assign(r,t.preferences)})),s&&setTimeout((function(){re.run()}));var F,R,V,U,z,G,te=[],ne={},re={contextMenu:null,isMutation:!1,run:function(){if(s=1,/m\.vk\.com/.test(location.hostname))return he.run();j?de.addFrameBtn():(fe.injectStyle(),P.a.isAvailable()&&(re.isMutation=!0,ce.addCustomStyle(),re.mutationMode.enable()))},changeState:function(e){A||(s=e,ie(),ce.hideLinks(),pe.off(),re.hideMenu(),fe.rmCurrentPhotoBtn(),ce.rmBitrate(),fe.rmPhotoAlbumDlBtn(),re.mutationMode.stop(),e&&re.run())},hideMenu:function(){re.contextMenu&&(re.contextMenu.hide(),re.contextMenu=null)},mutationMode:{observer:null,stop:function(){this.observer&&this.observer.stop(),["sfSkip"].forEach((function(e){for(var t,n=Object(m.a)(e),r=document.querySelectorAll("["+n+"]"),a=0;t=r[a];a++)t.removeAttribute(n)}))},wrapNewAudioOnMouseOver:function(){s&&ce.onNewMouseOver.apply(this,arguments)},wrapNewVoiceOnMouseOver:function(){var e=Object(k.a)(this,".im-mess");if(!(e&&e.querySelector(".sf-voice-btn")||!s)){var t=O.a.create("a",{href:this.getAttribute("data-mp3")||"#sf-preload",class:[ce.className,"sf-audio-btn","sf-voice-btn"],download:L.a.modify(this.getAttribute("data-mp3"))||"",style:{width:"3px",height:"3px",padding:"0px 9px 9px"},on:[["click",function(e){e.stopPropagation(),n.downloadOnClick(e)}]]}),r=e.querySelector(".im-mess--actions, .audio-msg-track--duration");Object(X.a)({category:"append",subcategory:"vk",event:"b"}),r&&(r.classList.contains("audio-msg-track--duration")&&t.classList.add("sf-voice-btn-in-dur"),r.appendChild(t),e.addEventListener("mouseleave",(function(){return t.style.display="none"})),e.addEventListener("mouseenter",(function(){return t.style.display="inline"}))),n.addStyleRules(".".concat(ce.className,".sf-voice-btn"),{"background-size":"12px !important"}),n.addStyleRules(".".concat(ce.className,".sf-voice-btn-in-dur"),{position:"absolute",top:"23px",right:"-13px"})}},wrapVideoFeedOnMouseOver:function(){s&&(Object(X.a)({category:"append",subcategory:"vk",event:"b"}),pe.onLinkHover.apply(this,arguments))},onVideoInsert:function(e){Object(D.a)("function(){return window.mvcur&&window.mvcur.mvData&&window.mvcur.mvData.is_active_live}").then((function(t){var r=n.getParentById(e,"mv_box");r||(r=e);var a=de.getPlayerNode(r);a&&!t?e.closest(".ShortVideoPost")||window.location.href.includes("clips")?de.newClipButton(a,r):de.newAppendButton(a,r):e.dataset.sfSkip=0}))},onVideoChange:(F=Object(i.a)(l.a.mark((function e(t){var n,r,a,o,i,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(D.a)("function(){return window.mvcur&&window.mvcur.mvData&&window.mvcur.mvData.is_active_live}");case 2:if(!e.sent){e.next=5;break}return e.abrupt("return");case 5:n=this,r=t,".like_cont"===t.className&&(r=t.closest('div[id=*="/video_box_wrap/"]')),/video_box_wrap-?\d+_-?\d+/.test(r.id)&&window.location.href.includes("clips")||/post-?\d+_?\d+/.test(r.id)?n.onVideoInsert(r):/video_box_wrap-?\d+_-?\d+/.test(r.id)||n.onVideoInsert(r),r.sfWatch?n.onVideoInsert(r):(r.sfWatch=!0,(a=new N.a({attrs:[{name:"id",callback:function(){n.onVideoInsert(r)}}],target:r})).trigger(),x.a.onRemoveEvent(r,(function(){a.stop(),r.sfWatch=!1,r.dataset.sfSkip=0}))),document.querySelector('iframe[src*="showjet"]')&&(o=document.querySelector('iframe[src*="showjet"]'),i=document.createElement("div"),(s=document.querySelector(".like_btns"))&&(s.insertBefore(i,s.querySelector(".ui_actions_menu_wrap._ui_menu_wrap")),Object(T.a)(Object(E.e)(W,{iframeSrc:o.src}),i)));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)}),newStoryButton:function(e){setTimeout((function(){var t=e.querySelector(".stories_item_cont_wrap"),r=t.querySelector(".stories_header_content"),a=O.a.create("div",{id:"savefrom__yt_btn",style:{display:"flex",position:"absolute",right:"0px",top:"60px",zIndex:1e3,pointerEvents:"auto",marginLeft:"10px",verticalAlign:"middle"},append:[O.a.create("a",{class:"sf-quick-dl-btn",style:{display:"inline-block",fontSize:"inherit",height:"22px",border:"1px solid #00B75A",borderRadius:"3px",borderTopRightRadius:0,borderBottomRightRadius:0,paddingLeft:"28px",cursor:"pointer",verticalAlign:"middle",position:"relative",lineHeight:"22px",textDecoration:"none",zIndex:1,color:"#fff",marginRight:"8px"},append:[O.a.create("i",{style:{position:"absolute",display:"inline-block",left:"6px",top:"3px",backgroundImage:"url("+n.svg.getSrc("download","#ffffff")+")",backgroundSize:"12px",backgroundRepeat:"no-repeat",backgroundPosition:"center",width:"16px",height:"16px"}})],on:[["click",function(){var e=Object(i.a)(l.a.mark((function e(n){var r,a,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.preventDefault(),e.next=3,K.a.createLinkExtractor("vk-story").extractLinks({element:t});case 3:return r=e.sent,a=Object(o.a)(r,1),i=a[0],e.abrupt("return",Object(M.a)({action:"downloadVkStory",downloadFileUrl:i.url,filename:i.filename}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()]]}),O.a.create("style",{text:Object(g.a)({selector:"#savefrom__yt_btn",append:[{"button::-moz-focus-inner":{padding:0,margin:0},".sf-quick-dl-btn":{backgroundColor:"#00B75A"},".sf-quick-dl-btn:hover":{backgroundColor:"rgb(0, 163, 80)"},".sf-quick-dl-btn:active":{backgroundColor:"rgb(0, 151, 74)"}},{media:"@media screen and (max-width: 1293px)",append:{".sf-quick-dl-btn .sf-btn-name":{display:"none"}}}]})})]}),s=new URLSearchParams(window.location.search).get("w");!r.querySelector("#savefrom__yt_btn")&&s&&r.append(a)}),500)},enable:function(){var e=this;if(this.observer)return this.observer.start();var t=function(t){for(var n,r=0;n=t.added[r];r++)if(!(n.dataset.sfSkip>0)){if("like_cont"===n.className&&!window.location.href.includes("clips"))return;n.dataset.sfSkip="1",e.onVideoChange(n)}},n=function(e){for(var t,n=0;t=e.added[n];n++)Object(X.a)({category:"append",subcategory:"vk",event:"b"}),t.dataset.sfSkip>0||(t.dataset.sfSkip="1",x.a.one(t,"mouseenter",re.mutationMode.wrapNewAudioOnMouseOver))};this.observer=new P.a({queries:[{css:".ShortVideoPost .video_box_wrap > #video_player",is:"added",callback:t},{css:".stories_item",is:"added",callback:function(t){for(var n,r=0;n=t.added[r];r++)n.dataset.sfSkip>0||(n.dataset.sfSkip="1",e.newStoryButton(n))}},{css:".post_video_desc a.lnk",is:"added",callback:function(e){for(var t,n=0;t=e.added[n];n++)t.dataset.sfSkip>0||(t.dataset.sfSkip="1",x.a.one(t,"mouseenter",re.mutationMode.wrapVideoFeedOnMouseOver))}},{css:"#mv_box #mv_player_box > .video_box_wrap",is:"added",callback:function(t){for(var n,r=0;n=t.added[r];r++)n.dataset.sfSkip>0||(n.dataset.sfSkip="1",e.onVideoChange(n))}},{css:"#mv_box #mv_player_box .video_box_wrap .like_cont",is:"added",callback:t},{css:"#mv_box #mv_player_box > .video_box_wrap > #video_player",is:"added",callback:function(t){for(var n,r=0;n=t.added[r];r++)(n=n.parentNode).dataset.sfSkip>0||(n.dataset.sfSkip="1",e.onVideoChange(n))}},{css:"#photos_all_block",is:"added",callback:function(e){for(var t,n=0;t=e.added[n];n++)t.dataset.sfSkip>0||(t.dataset.sfSkip="1",fe.addNewPhotoAlbumDlBtn(t))}},{css:".pv_photo_wrap .pv_img_area_wrap",is:"added",callback:function(e){for(var t,n=0;t=e.added[n];n++)t.dataset.sfSkip>0||(t.dataset.sfSkip="1",fe.addNewDlCurrentPhotoBtn(t))}},{css:".audio_row",is:"added",callback:n},{css:".top_audio_player .top_audio_player_title",is:"added",callback:n},{css:".audio_page_player .audio_page_player_title_performer",is:"added",callback:n},{css:".audio-msg-track",is:"added",callback:function(e){for(var t,n=0;t=e.added[n];n++)t.dataset.sfSkip>0||(t.dataset.sfSkip="1",x.a.one(t,"mouseenter",re.mutationMode.wrapNewVoiceOnMouseOver))}},{css:"."+x.a.onRemoveClassName,is:"removed",callback:function(e){for(var t,n=0;t=e.removed[n];n++)x.a.onRemoveListener(t)}}]})}}},ae=function(e){for(var t=e[0].quality,n=0,r=0;r<e.length;r++)t<e[r].quality&&(t=e[r].quality,n=r);return e[n].href},oe=function(){re.changeState(0),re.changeState(1)},ie=function(){ce.lastRow=null;for(var e=document.querySelectorAll("a.savefrom_vk_download,div.savefrom_vk_download,span.savefrom_vk_download"),t=e.length-1;t>=0;t--)ce.elIsHidden(e[t])&&e[t].parentNode.removeChild(e[t])},se=function(){if(null!==document.querySelector('.page_block_header_inner._header_inner a.ui_crumb[href="/audio"]')){var e=document.querySelector(".page_block_header_inner._header_inner div.ui_crumb");if(e&&e.textContent)return L.a.modify(e.textContent)}var t=document.title,n=t.indexOf("|");return-1!==n&&(t=t.substr(0,n-1)),L.a.modify(t)},le=function(e){try{var t=JSON.parse(e).payload[1];return[null,null,null,null,null,t[0],t[1],null,t[3]]}catch(e){}for(var n=function(e){return!0===e?1:parseInt(e)||0},r=function(e){return!0===e?1:parseFloat(e)||0},a=e.split("<!>"),o=a.length-1;o>=0;--o){var i=a[o];if("<!"==i.substr(0,2)){var s=i.indexOf(">"),l=i.substr(2,s-2);switch(i=i.substr(s+1),l){case"json":var u=null;try{u=JSON.parse(i)}catch(e){}a[o]=u;break;case"int":a[o]=n(i);break;case"float":a[o]=r(i);break;case"bool":a[o]=!!n(i);break;case"null":a[o]=null;break;case"pageview_candidate":a.pop();break;case"debug":a.pop()}}}return a},ue=function(e){return/<em>.*<\/em>/.test(e)&&(e=e.replace(/<\/?em>/g,"")),e},ce={audioElClassList:["audio","audioRow","audioRowWall"],lastRow:null,className:"savefrom_vk_download",cache:{},lastValidRequest:null,waitUntilUnblock:function(e){var t=this,n=10;if(!t.lastValidRequest)return Promise.reject(new Error("Last valid request is empty!"));return function r(){return new Promise((function(e){setTimeout(e,15e3)})).then((function(){if(e.abort)throw new Error("Abort");return Object(_.a)(t.lastValidRequest).then((function(e){if(n--,!le(e.body)[5]){if(n>0)return r();throw new Error("Can't request data")}}))}))}().then((function(){return new Promise((function(e){setTimeout(e,250)}))}))},needUnmask:function(e){var t=/audio_api_unavailable/;return e.some((function(e){if(t.test(e[2]))return!0}))},unmaskUrlViaUtil:function(e){return ce.needUnmask(e)?Object(D.a)([],"function(){return vk.id}").then((function(t){var n=e.map((function(e){try{return Array.isArray(e)&&e[2]?(e[2]=I.a(t,e[2]),e):null}catch(e){return Z.debug("track decode error: ",e),null}}));return Promise.all(n).then((function(e){return e.filter((function(e){return null!==e}))}))})):Promise.resolve(e)},unmaskUrl:function(e){return ce.needUnmask(e)?Object(D.a)([e],'function(idsArr){var aFail=false;var bFail=false;var cFail=false;var unmaskUrl=function unmaskUrl(url){var _url="";if(!aFail&&window.sfUnmaskUrl){try{_url=window.sfUnmaskUrl(url)}catch(err){aFail=true}}if(!cFail&&!_url&&window.AudioPlayerHTML5){try{var res=null;var r={_isHlsUrl:function _isHlsUrl(url){res=url;return true},_initHls:function _initHls(){}};window.AudioPlayerHTML5.prototype._setAudioNodeUrl.apply(r,[null,url]);_url=res}catch(err){cFail=true}}if(!bFail&&!_url&&window.AudioPlayerFlash){try{var r={};window.AudioPlayerFlash.prototype.setUrl.apply(r,[url]);_url=r._url}catch(err){bFail=true}}if(typeof _url!=="string"){_url=""}return _url};idsArr.forEach(function(item){var url=unmaskUrl(item[2]);if(url){item[2]=url}});return idsArr}').then((function(t){return t||e})):Promise.resolve(e)},_getNewTrackListByIdsWithActionHash:function(e){for(var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=9,a=0,o={},i=this.cache,s=e.filter((function(e){var t=e.fullId;return!i[t]||(o[t]=i[t],a++,!1)})),l=[];s.length;)l.push(s.splice(0,r));var u=e.length,c=Promise.resolve();l.forEach((function(e){c=c.then((function(){var r=function(){if(n.abort)throw new Error("Abort");var r=e.filter((function(e){return e.fullId&&e.actionHash&&e.urlHash})).map((function(e){return e.fullId+"_"+e.actionHash+"_"+e.urlHash})),s={type:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},data:Q.stringify({act:"reload_audio",al:1,ids:r.join(",")}),url:"/al_audio.php",localXHR:!0};return Object(_.a)(s).then((function(e){var r=le(e.body)[5];if(!r||!Array.isArray(r))throw new Error("Track list is not found!");return t.lastValidRequest=s,r.forEach((function(e){var t=e[1]+"_"+e[0];i[t]=e,o[t]=e,a++})),n.onProgress&&n.onProgress(a,u),new Promise((function(e){setTimeout(e,250)}))}))},s=2;return function e(){return r().catch((function(a){if("Track list is not found!"===a.message&&!n.withoutUnblock){if(t.lastValidRequest)return t.waitUntilUnblock(n).then(r);if(s-- >0)return new Promise((function(e){return setTimeout(e,15e3)})).then((function(){return e()}))}throw a}))}().catch((function(e){"Abort"!==e.message&&Z.debug("requestIds error!",e)}))}))})),c=c.then((function(){Object.keys(i).slice(1e3).forEach((function(e){delete i[e]}));var t=[];return e.forEach((function(e){var n=e.fullId,r=o[n];r&&t.push(r)})),t}));var d=function(e){if(ce.isHlsLink(e)){var t=(e=e.replace("/index.m3u8",".mp3")).split("/"),n=-1!==e.indexOf("audios")?1:0;return t.splice(t.length-(2+n),1),t.join("/")}return e};return c=c.then((function(e){return ce.unmaskUrlViaUtil(e)})).then((function(e){var t=Object(J.a)(5),n=e.map((function(e){return t((function(){var t=e[2],n=d(t);return ce.isHlsLink(t)?Object(_.a)({method:"HEAD",url:n}).then((function(){return e[2]=n,e}),(function(t){return Z.warn("getNewTrackListByIdsWithActionHash: mp3 file not available. ",t),e})):e}))}));return Promise.all(n)}))},_getAlbumIdFromUrl:function(e){var t=this,n=[e],r=Object(h.a)(e);r.z&&n.unshift(r.z);var a=null;return n.some((function(e){if(a=t._getAlbumId(e))return!0})),a},_getAlbumId:function(e){if(/[?&]q=/.test(e))return null;var t={url:"/al_audio.php",data:{}},n=/audio_playlist(-?\d+)_(-?\d+)(?:\/(\w+))?/.exec(e);if(n&&(t.data.access_hash=n[3]||"",t.data.act="load_section",t.data.al=1,t.data.claim=0,t.data.owner_id=n[1],t.data.playlist_id=n[2],t.data.type="playlist",t.data.offset=0),!t.data.act){var r=/audios(-?\d+)/.exec(e);if(r){var a=/[?&]section=(\w+)/.exec(e),o=a&&a[1];if(o&&-1===["playlists","all"].indexOf(o))return null;t.data.access_hash="",t.data.act="load_section",t.data.al=1,t.data.claim=0,t.data.owner_id=r[1],t.data.playlist_id=-1,t.data.type="playlist",t.data.offset=0}}return t.data.act?t:null},getNewNodeTrackInfo:(U=Object(i.a)(l.a.mark((function e(t){var n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.readNewDataAudio(t.dataset.audio),(r=this.getNewTrackInfo(n))&&r.fullId){e.next=4;break}throw new Error("Track info is not found");case 4:if(!r.url){e.next=6;break}return e.abrupt("return",ce.unmaskUrlViaUtil([[null,null,r.url]]).then((function(e){return r.url=e[0][2],r})));case 6:return e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return U.apply(this,arguments)}),_getAlbumTrackViaApi:function(e,t){if(!e.url)throw Z.debug("Page is not exists!",e),new Error("Page is not exists!");var n=JSON.parse(JSON.stringify(e.data)),r=function(){return t.abort?Promise.reject(new Error("Abort")):Object(_.a)({type:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},url:e.url,data:n,timeout:6e4,localXHR:!0}).then((function(e){var t=le(e.body)[5];if(!t)throw new Error("Album data is empty!");return new Promise((function(e){setTimeout(e,250)})).then((function(){return t}))}))};return r().then((function(e){var t=20;return e.hasMore?function a(o){return!o||t<0?e:(t--,n.offset=o,r().then((function(t){return t.list.length?(e.list.push.apply(e.list,t.list),t.hasMore?a(t.nextOffset):e):e}),(function(t){return"Abort"!==t.message&&Z.debug("getOffset error!",t),e})))}(e.nextOffset):e}))},_getAllTrackViaDom:function(e,t){var n=this;t=t||{};var r=[];return[].slice.call(e.querySelectorAll(".audio_row")).forEach((function(e){if((!t.fromPage||!n.elIsHidden(e))&&(t.grabReply||!fe.isReply(e))){var a=null;try{a=JSON.parse(e.dataset.audio)}catch(e){}a&&r.push(a)}})),{list:r}},_getNewAudioLinks:function(e,t){var n=this;t=t||{};var r=(e=e||document)===document,a=fe.getPopup("","audio",(function(){t.abort=!0}));a.onPrepare(u.a.i18n.getMessage("download")+" ...");var o=function(){return Promise.resolve().then((function(){return n._getAllTrackViaDom(e,{fromPage:r,grabReply:!1})}))};t.onProgress=function(e,t){a.onProgress(e,t)};var i=Promise.resolve();return i=(i=(i=(i=r?i.then((function(){return Promise.resolve().then((function(){var e=n._getAlbumIdFromUrl(location.href);if(!e)throw new Error("Album is not found");return n._getAlbumTrackViaApi(e,t)}))})).catch((function(e){throw"Album is not found"!==e.message&&Z.debug("findAlbumLinks error!",e),e})).catch((function(){return o()})):i.then(o)).then((function(e){var t=e.list;if(!t.length)throw new Error("Audio is not found");return a.onProgress(0,t.length),e}))).then((function(e){var r=[],a="";"string"==typeof e.title&&(a=L.a.modify(e.title));var o=[];return e.list.forEach((function(e){var t=e[1]+"_"+e[0],n=ce.getTrackActionHash(e),a=ce.getTrackUrlHash(e);-1===o.indexOf(t)&&(o.push(t),r.push({fullId:t,actionHash:n,urlHash:a}))})),n._getNewTrackListByIdsWithActionHash(r,t).then((function(e){var t={},r=[];return e.forEach((function(e){var a=n.getNewTrackInfo(e);if(a&&a.url){var o=n.getNewAudioFilename(a),i=n.getNewAudioFullTitle(a);t[a.fullId]=a.url,r.push({url:a.url,title:i,filename:o})}})),{linkList:t,trackList:r,title:a}}))}))).then((function(e){return a.onReady(),e}),(function(e){throw a.onReady(),e}))},tooltip:{tooltip:void 0,updatePos:function(e,t){var r=n.getPosition(e),a=n.getSize(this.tooltip);this.tooltip.style.top=r.top+t.top-a.height+"px";var o=r.left+parseInt(t.width/2)-parseInt(a.width/2),i=document.body.clientWidth+document.body.scrollLeft;i<o+a.width&&(o=i-a.width),this.tooltip.style.left=o+"px"},show:function(e,t){var n=this;return void 0!==this.tooltip?this.hide():(this.tooltip=O.a.create("div",{class:"sf-tooltip",style:Object.assign({position:"absolute",display:"none",zIndex:9999,opacity:0,transition:"opacity 0.2s",whiteSpace:"nowrap"},t.style),on:["mouseenter",function(e){n.hide()}]}),document.body.appendChild(this.tooltip)),this.tooltip.style.display="block",setTimeout((function(){n.updatePos(e,t),n.tooltip.style.opacity=1}),0),this.tooltip},hide:function(){this.tooltip&&(this.tooltip.style.opacity=0,this.tooltip.style.display="none")}},rmBitrate:function(){void 0===ce.rmBitrate.style&&document.body.appendChild(ce.rmBitrate.style=O.a.create("style",{text:".sf-bitrate-value {display: none;}"}));for(var e,t=document.querySelectorAll(".sf-bitrate-value"),n=0;e=t[n];n++)e.parentNode.removeChild(e)},insertNewBitrate:function(e,t){if(e&&t&&t.classList.contains("audio_row__info")){var n=t.querySelector(".audio_row__duration");if(n&&(void 0!==ce.rmBitrate.style&&(ce.rmBitrate.style.parentNode.removeChild(ce.rmBitrate.style),ce.rmBitrate.style=void 0),!n.querySelector(".sf-bitrate-value"))){var r=O.a.create("span",{text:" "+e,class:"sf-bitrate-value",style:{position:"absolute",textAlign:"right",right:0,opacity:"0.8",top:"14px",fontSize:"11px",whiteSpace:"nowrap"}});n.appendChild(r)}}},onDlBtnLeave:function(){ce.tooltip.hide()},onDlBtnOver:function(){var e=ce,t=e.tooltip,n=this,r=n.dataset.fullId,a=n.parentNode&&n.parentNode.parentNode,o=-6;n.dataset.bitrateOffsetTop&&(o=parseInt(n.dataset.bitrateOffsetTop));var i={top:o,width:24,style:{backgroundColor:"#fff",border:"1px solid #ccc",color:"rgb(48, 48, 48)"}},s=t.show(n,i);s.dataset.fullId=r;var l=function(){var t=n.dataset.bitrate,r=n.dataset.size,o="";e.isHlsLink(n.href)?o=u.a.i18n.getMessage("download"):r?t?(e.insertNewBitrate(t,a),o=r+" ~ "+t):o=r:o=u.a.i18n.getMessage("getFileSizeFailTitle"),s.style.padding="2px 5px 3px",s.textContent=o};n.dataset.size||e.isHlsLink(n.href)?l():(s.style.padding="2px 2px 0 2px",s.textContent="",s.appendChild(O.a.create("img",{src:"/images/upload.gif",height:8,width:32,style:{marginTop:"2px",marginBottom:"1px"}})),n.dataset.preloadOver||(n.dataset.preloadOver=1,e._preloadNewTrackUrl(n).then((function(o){if(n.dataset.preloadOver=2,n.href=o,!e.isHlsLink(o))return e._onOverInsertBitrate(n,a).then((function(){s.dataset.fullId===r&&(l(),t.updatePos(n,i))}));l(),t.updatePos(n,i)})).catch((function(e){Z.error("_preloadNewTrackUrl error",e),n.dataset.preloadOver="",s.dataset.fullId===r&&(l(),t.updatePos(n,i))}))))},preloadIdPromiseMap:{},_preloadNewTrackUrl:function(e){var t=this,n=t.preloadIdPromiseMap,r=e.dataset.fullId,a=e.dataset.actionHash,o=e.dataset.urlHash,i=n[r];return i||(i=n[r]=t._getNewTrackListByIdsWithActionHash([{fullId:r,actionHash:a,urlHash:o}],{withoutUnblock:!0}).then((function(e){delete n[r];var a=null;e.some((function(e){if(e[1]+"_"+e[0]===r)return a=e,!0}));var o=a&&t.getNewTrackInfo(a);if(!o||!o.url)throw new Error("Track is not found");return o.url}),(function(e){throw delete n[r],e})).then((function(e){return ce.unmaskUrl([e])})).then((function(e){return e[0]}))),i},isHlsLink:function(e){return/\.m3u8(\?|$)/.test(e)},onNewDlBtnClick:function(e){ce.isHlsLink(this.href)?(e.preventDefault(),Object(T.a)(Object(E.e)(H.a,{sources:[{url:this.href,format:"hls"}],filename:this.download,format:"mp3",convertType:"hlsToMp3"}),"sf-muxer-parent")):n.downloadOnClick(e);for(var t,r=document.querySelectorAll("._audio_row_"+this.dataset.fullId),a=0;t=r[a];a++)t.style.backgroundColor="#f4f7fc"},_onNewDlBtnClickWrapper:function(e){var t=ce,n=this;e.stopPropagation(),(n.dataset.preloadOver>1||n.dataset.preloadBitrate>1)&&(n.dataset.preloadDl=2),n.dataset.preloadDl?n.dataset.preloadDl>1?ce.onNewDlBtnClick.call(n,e):e.preventDefault():(e.preventDefault(),n.dataset.preloadDl=1,t._preloadNewTrackUrl(n).then((function(t){n.dataset.preloadDl=2,n.href=t,ce.onNewDlBtnClick.call(n,e)}),(function(e){Z.error("_preloadNewTrackUrl error",e),n.dataset.preloadDl=""})))},getNewDlBtn:function(e){var t={href:e.url||"#sf-preload",class:[ce.className,"sf-audio-btn"],download:e.filename||"",data:{duration:e.duration||"",fullId:e.fullId,actionHash:e.actionHash,urlHash:e.urlHash},style:{width:"16px",height:"16px"},on:[["mouseenter",this.onDlBtnOver],["mouseleave",this.onDlBtnLeave],["click",this._onNewDlBtnClickWrapper],["mousedown",function(e){e.stopPropagation()}]]};return(u.a.isGM||u.a.isSafari)&&(t.title=u.a.i18n.getMessage("downloadTitle")),O.a.create("a",t)},preloadSizePromiseMap:{},_onOverInsertBitrate:function(e,t){var r=this,a=r.preloadSizePromiseMap,o=e.dataset.fullId,i=a[o];return i||(i=a[o]=function(e){var t=ne[e];if(t){var n=te.indexOf(e);-1!==n&&(te.splice(n,1),te.unshift(e))}else if(t=ne[e]=Object(M.a)({action:"getFileSize",url:e}).then((function(t){return t&&!t.error||delete ne[e],t})).catch((function(t){throw delete ne[e],t})),te.unshift(e),te.length>100){var r=te.pop();delete ne[r]}return t}(e.href).then((function(i){if(delete a[o],!i)throw new Error("Response is empty");if(!i.fileSize)throw delete r.cache[o],new Error("File size is empty");var s=n.sizeHuman(i.fileSize,2),l="";e.dataset.duration&&(l=Math.floor(i.fileSize/e.dataset.duration/125)+" "+u.a.i18n.getMessage("kbps")),e.dataset.bitrate=l,e.dataset.size=s,ce.insertNewBitrate(l,t)}),(function(e){throw delete a[o],e}))),i},getNewAudioFullTitle:function(e){var t=[];return e.title&&t.push(e.title),e.performer&&(t.length&&t.unshift(" - "),t.unshift(e.performer)),t.join("")},getNewAudioFilename:function(e){var t=this.getNewAudioFullTitle(e);return t&&(t+=".mp3"),t},handleNewCurrentAudioRow:(V=Object(i.a)(l.a.mark((function e(t,r){var a,i,s,u,c,d,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.querySelector("."+ce.className)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,K.a.createLinkExtractor("vk-audios").extractLinks({element:t});case 4:a=e.sent,i=Object(o.a)(a,1),s=i[0],u=this.getNewDlBtn(s),c="#6C8CAC",1===r&&(c="#C4D1DE"),u.classList.remove("sf-audio-btn"),O.a.create(u,{style:{background:"url("+n.svg.getSrc("download",c)+") center no-repeat",backgroundSize:"12px",width:"12px",height:"12px",padding:0,margin:0,cssFloat:"left",marginRight:"3px",marginTop:"6px",marginBottom:"-2px"}}),d=null,x.a.onRemoveEvent(u,(function(){x.a.one(t,"mouseenter",re.mutationMode.wrapNewAudioOnMouseOver),d&&d.stop()})),2===r&&(p=Object(k.a)(t,".audio_page_player"))&&(d=new N.a({target:p,attrs:[{name:"data-full-id",callback:function(){u.parentNode&&u.parentNode.removeChild(u),d&&d.stop()}}]})).trigger(),1===r&&(u.dataset.bitrateOffsetTop=1),t.insertBefore(u,t.firstChild);case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return V.apply(this,arguments)}),handleNewAudioRow:(R=Object(i.a)(l.a.mark((function e(t){var n,a,i,s,u,c,d,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.querySelector("."+ce.className)){e.next=2;break}return e.abrupt("return");case 2:return n=t.querySelector(".audio_row__actions"),e.next=5,K.a.createLinkExtractor("vk-audios").extractLinks({element:t});case 5:a=e.sent,i=Object(o.a)(a,1),s=i[0],u=this,c=this.getNewDlBtn(s),d=n.parentNode,O.a.create(c,{class:["audio_row__action"],style:{width:"24px",height:"24px",cssFloat:"left"},on:[["mouseover",function(e){if(ee){if(!e.altKey&&!e.ctrlKey)return e.preventDefault(),void Object($.b)(c,{defaultWidth:400,defaultHeight:60},{});Object($.a)(c,{defaultWidth:400,defaultHeight:60})}}]]}),(p=n.firstChild)?n.insertBefore(c,p):n.appendChild(c),1===r.vkShowBitrate&&(c.dataset.preloadBitrate||(c.dataset.preloadBitrate=1,u._preloadNewTrackUrl(c).then((function(e){return c.dataset.preloadBitrate=2,c.href=e,u._onOverInsertBitrate(c,d)})).catch((function(e){Z.error("_preloadNewTrackUrl error",e)}))));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return R.apply(this,arguments)}),addNewDlTrackBtn:function(e){var t=this,n=function(){a.disconnect()},r=function(){t.handleNewAudioRow(e).catch((function(){return n()}))},a=new(Object(C.a)())((function(e){if(s){for(var t=null,a=null,o=0;t=e.shift();)if("childList"===t.type&&t.addedNodes.length&&t.target.classList.contains("audio_row__info"))for(o=0,t.addedNodes;a=t.addedNodes[o];o++)if(a.classList.contains("audio_row__actions"))return void r()}else n()}));a.observe(e,{childList:!0,subtree:!0});var o=e.querySelector(".audio_row__actions");o&&(r(),o=null)},getNewTrackInfo:function(e){if(!e)return null;var t={};return"string"==typeof e[2]&&(t.url=e[2]),t.title=e[3],t.title&&(t.title=L.a.decodeSpecialChars(ue(t.title))),t.performer=e[4],t.performer&&(t.performer=L.a.decodeSpecialChars(ue(t.performer))),t.duration=parseInt(e[5]),t.actionHash=ce.getTrackActionHash(e),t.urlHash=ce.getTrackUrlHash(e),e[1]&&e[0]&&(t.fullId=e[1]+"_"+e[0]),t.id=e[0],t.ownerId=e[1],t},getTrackActionHash:function(e){return(e[13]||"").split("/")[2]||""},getTrackUrlHash:function(e){return(e[13]||"").split("/")[5]||""},readNewDataAudio:function(e){try{return JSON.parse(e)}catch(e){return null}},addNewDlCurrentTrackBtn:function(e,t){this.handleNewCurrentAudioRow(e,t)},onNewMouseOver:function(e){var t=ce;if(this&&!this.querySelector("."+ce.className)){var n=null;this.classList.contains("top_audio_player_title")&&(n=1),this.classList.contains("audio_page_player_title_performer")&&(n=2),n?t.addNewDlCurrentTrackBtn(this,n):t.addNewDlTrackBtn(this)}},addCustomStyle:function(){if(1!==this.addCustomStyle.hasStyle){this.addCustomStyle.hasStyle=1;var e=document.querySelector("#savefrom-styles.sf-audio");e&&e.parentNode.removeChild(e),n.addStyleRules(".savefrom_vk_download.sf-audio-btn",{background:"url("+n.svg.getSrc("download","#5f7fa2")+") center no-repeat !important",opacity:"0.4"},"sf-audio")}},hideLinks:function(){if(this.addCustomStyle.hasStyle){this.addCustomStyle.hasStyle=0;var e=document.querySelector("#savefrom-styles.sf-audio");e&&e.parentNode.removeChild(e),n.addStyleRules(".savefrom_vk_download",{display:"none"},"sf-audio")}ce.tooltip.tooltip&&(ce.tooltip.tooltip.parentNode.removeChild(ce.tooltip.tooltip),ce.tooltip.tooltip=void 0),ce.cache={}},elIsHidden:function(e){return null===e.offsetParent},downloadMP3Files:function(){var e=fe.getLayer()||document;ce._getNewAudioLinks(e).then((function(e){e.linkList;var t=e.trackList,r=e.title||se(),a=t.map((function(e){return ce.isHlsLink(e.url)?{filename:e.filename,sources:[{url:e.url,format:"hls"}],format:"hls",useConverter:!0}:e}));if(0===a.length)return alert(u.a.i18n.getMessage("vkMp3LinksNotFound"));n.downloadList.showBeforeDownloadPopup(a,{type:"audio",folderName:r})}),(function(e){"Abort"!==e.message&&(Z.debug("_getNewAudioLinks error!",e),alert(u.a.i18n.getMessage("vkMp3LinksNotFound")))}))},showListOfAudioFiles:function(e){var t=fe.getLayer()||document;ce._getNewAudioLinks(t).then((function(t){var r=t.linkList,a=t.trackList,o=t.title||se(),i=null;if(e){if(0!==(i=a).length)return n.playlist.popupPlaylist(i,o,!0)}else{for(var s in i=[],r)i.push({url:r[s]});if(0!==i.length)return n.playlist.popupFilelist(i)}alert(u.a.i18n.getMessage("vkMp3LinksNotFound"))}),(function(e){"Abort"!==e.message&&(Z.debug("_getNewAudioLinks error!",e),alert(u.a.i18n.getMessage("vkMp3LinksNotFound")))}))},requestReloadAudio:function(e,t,n){var r={act:"reload_audio",ids:"".concat(e,"_").concat(t,"_").concat(n)};return Object(_.a)({type:"POST",url:"/audio",json:!0,data:r}).then((function(e){var t=e.body.data;return ce.getNewTrackInfo(t[0][0])}))}},de={panelId:"savefrom__vk_video_links",videoAttr:"data-savefrom-video",hiddenAttr:"data-savefrom-hidden",btnBoxId:"sf-iframe-dl-btn",btnBox:null,style:{fontSize:"10pt",margin:"15px 0",padding:"0"},getLinksFormUrl:function(e){if(e){if("//"===e.substr(0,2)&&(e="http:"+e),r.showUmmyItem&&this.isRutubeLink(e))return de.getRutubeLinks(e);if(this.isPladformLink(e))return de.getPladformLinks(e);var t,a=n.embedDownloader.hostings;for(var o in a){for(var i,s=a[o],l=0;i=s.re[l];l++){var u=e.match(i);if(u){t={hosting:o,action:s.action,extVideoId:u[1]};break}}if(t)break}if(t)return{request:t}}},getLinksFromFlashVars:function(e){var t=Object(h.a)(e,{params:!0});return de.getLinksFromHtml5MetaData(t)},getLinksFromHtml5MetaData:function(e){if(e){var t=e.md_title;if(void 0!==t){var n=Object.keys(e).some((function(e){return e.match(/cache([0-9]+)/)}))?/cache([0-9]+)/:/url([0-9]+)/,r={},a=!1;for(var o in e){var i=null;if("extra_data"!==o||"52"!==e.extra){if(null!==(i=o.match(n))){var s=e[o],l=s.indexOf("?");-1!==l&&(s=s.substr(0,l)),a=!0,r[i[1]]=s}}else r[i=e.hd?"HD":"SD"]=e[o],a=!0}if(a)return{title:t,links:r}}}},getRutubeLinks:function(e){if(/rutube[^\/]+\/(?:play|video)\/embed\/(\d+)/.test(e)||/video\.rutube\./.test(e))return{isUmmy:!0,links:n.popupMenu.prepareLinks.rutube(e)}},isRutubeLink:function(e){return/\/\/.*rutube\..*/.test(e)},getPladformLinks:function(e){if(e){var t=Object(h.a)(e);return{request:{action:"getPladformVideo",extVideoId:{playerId:t.pl,videoId:t.videoid}}}}},isPladformLink:function(e){return/\/\/.*pladform\..*/.test(e)},getLinksVideoEl:function(e,t){var n=t.querySelector(".vv_summary");if(!n)return null;n=n.textContent;for(var r,a,o={},i=e.querySelectorAll("source"),s=0;a=i[s];s++){var l=a.src||"",u=l.indexOf("?");-1!==u&&(l=l.substr(0,u));var c=l.match(/\.(\d+)\.[^\/]+$/);null!==c&&(o[c[1]]=l,r=!0)}return r?{title:n,links:o}:void 0},getPlayerNode:function(e){var t=null;return e.closest(".ShortVideoPage__container")?e:(["iframe.video_yt_player","#html5_player","#flash_video_obj","#playerObj","#player",".video_box_wrap > #video_player"].some((function(n){if(t=e.querySelector(n))return!0})),t)},getLinksFromMv:function(e,t,n){return Object(D.a)([t,e],(function(e,t){var r=window.mvcur;if(r&&r.player&&r.player.vars){var a=r.player.vars;return a.vid!==e||a.oid!==t?n():{vars:r.player.vars}}})).then((function(e){return e?de.getLinksFromHtml5MetaData(e.vars):null}))},getLinksFromFrame:function(e){var t=document.body.innerHTML,n=Object(h.a)(location.href),r=parseInt(n.oid),a=parseInt(n.id);if(r&&a){var o=null;if(Object(v.a)(t,[/"vid":/,/"oid":/,/"md_title":/]).some((function(e){return o=e,!0})),o&&o.vid===a&&o.oid===r)return e(null,{request:{hosting:"vk",action:"getVkLinksFromJsonMsg",json:o}});var i=document.body,s=de.getPlayerNode(i);if(s)return de.getLinksFromPlayer(i,s,(function(t){t&&e(null,t)}))}return e("ERROR")},getLinksFromPlayer:function(e,t,r){if(t){var a,o;if("OBJECT"===t.tagName)(o=t.querySelector('param[name="flashvars"]'))&&(o=o.getAttribute("value"),a=de.getLinksFromFlashVars(o));else if("IFRAME"===t.tagName){var i=t.getAttribute("src");a||(a=de.getLinksFormUrl(i))}else if("EMBED"===t.tagName){var s=t.getAttribute("src");a||(o=t.getAttribute("flashvars"))&&(a=de.getLinksFromFlashVars(o)),a||(a=de.getLinksFormUrl(s))}if(a)return r(a,e);if("DIV"===t.tagName&&"video_player"===t.id){var l=t.parentNode.id,u=l&&l.match(/video_box_wrap(-?\d+)_(-?\d+)/);if(u)return u.shift(),u=u.map((function(e){return parseInt(e)})),Object(D.a)(u,(function(e,t){var n=window.mvcur,r="video"+e+"_"+t;return n&&n.listId&&(r="".concat(r)),{path:r}})).then((function(t){if(t)return r({request:{hosting:"vk",action:"getVKLinks",extVideoId:t.path,oidVid:u}},e)}))}if("html5_player"===t.id)return Object(D.a)((function(){return window.html5video&&window.html5video.vars?window.html5video.vars:r()})).then((function(t){var n=de.getLinksFromHtml5MetaData(t);if(n)return r(n,e)}));if("A"===t.tagName){var c=t.href,d=Object(h.a)(c);if(d.to)return a=n.embedDownloader.checkUrl(d.to),r(a?{request:a}:null,e)}return r(null,e)}},preparePladformLinks:function(e){e&&"getRutubeLinks"===e.action&&(e.links=null);var t=e&&e.links,n="noname",r={};if(t)for(var a,o=0;a=t[o];o++)n=a.title,r[a.quality]&&(a.quality=0),r[a.quality.toUpperCase()]=a.url;return{title:n,links:r}},prepareLinks:function(e){var t=e.title,n=[];for(var r in e.links){var a=e.links[r],o=a.match(/[\w]+\.(mp4|flv)(?:\?|$)/i),i=(o=o?o[1]:"flv").toUpperCase();n.push({href:a,quality:r,title:t,ext:o,format:i,forceDownload:!0})}return n},getVideoLinksAsAjax:function(e){var t=/video(-?\d+_-?\d+)/.exec(e);t=t&&t[1];var n=Object(h.a)(e).list;return fe._getModuleName().then((function(e){return new Promise((function(r){pe.getLinkAsAjax([t,n],(function(e,t){r({hosting:t,response:e})}),e)}))}))},prepareVideoLinks:function(e){return Object(i.a)(l.a.mark((function t(){var i,s,u,c,d,p,f,h,m,v,g,b,k,y,w,x,O,S,L,A,j,P,C,N,I,D,F,R;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=[],!e||!e.oidVid){t.next=7;break}return s=Object(o.a)(e.oidVid,2),u=s[0],c=s[1],t.next=5,de.getLinksFromMv(u,c);case 5:(d=t.sent)&&(p=i).push.apply(p,Object(a.a)(de.prepareLinks(d)));case 7:return t.next=9,Object(M.a)(e);case 9:if((f=t.sent)&&("getPladformVideo"===e.action?r.showUmmyItem&&"getRutubeLinks"===f.action?(h=i).push.apply(h,Object(a.a)(n.popupMenu.prepareLinks.rutube(f.links))):(m=i).push.apply(m,Object(a.a)(de.prepareLinks(de.preparePladformLinks(f)))):f.links&&(v=n.embedDownloader.reMapHosting(f.action))&&(g=i).push.apply(g,Object(a.a)(n.popupMenu.prepareLinks[v](f.links,f.title)))),i.length||"getVKLinks"!==e.action){t.next=18;break}return t.next=14,de.getVideoLinksAsAjax(e.extVideoId);case 14:b=t.sent,k=b.hosting,(y=b.response)&&y.links&&(y.isUmmy?(w=i).push.apply(w,Object(a.a)(y.links)):(x=i).push.apply(x,Object(a.a)(n.popupMenu.prepareLinks[k](y.links,y.title))));case 18:if(O=i.filter((function(e){return-1!==e.href.indexOf("mycdn.me/")})),S=i.filter((function(e){return-1!==e.href.indexOf("vkuser")})),!(O.length||S||i.length<=2)){t.next=40;break}if(!e.extVideoId){t.next=40;break}return A={},(j=document.querySelector('a[href*="'+e.extVideoId+'"]'))&&j.dataset.length&&((P=j.closest('[id*="post"]'))&&(A.post_id=P.dataset.postId),A.list=j.dataset.list,A.paylist_id="wall_"+j.dataset.video.split("_")[0]),A.video=e.extVideoId.split("?")[0].replace("video",""),(C=location.href.match(/pl_(wall_.\d+)/))&&C[1]&&(A.playlist_id=C[1]),(N=document.querySelector('a[data-video="'.concat(A.video,'"]')))&&N.dataset.list&&(A.list=N.dataset.list),t.next=32,Object(_.a)({type:"POST",url:"https://vk.com/al_video.php?act=show",data:Y({act:"show",al:1,autoplay:1,module:"groups"},A)});case 32:return I=t.sent,t.next=35,q.a(f?f.title:"title",I.body);case 35:D=t.sent,F=D.hls,R=D.mp4,(L=i).push.apply(L,Object(a.a)(R).concat(Object(a.a)(F))),i=Object(B.a)(i,"href");case 40:return t.next=42,q.b(Object(B.a)(i,"quality","itag"),(function(e){return 22==e.itag}));case 42:return i=(i=t.sent).map((function(e){return e.title="."===e.title?"video-"+e.quality:e.title,e})),t.abrupt("return",i);case 45:case"end":return t.stop()}}),t)})))()},newAppendButton:function(e,r){if(e){Object(X.a)({category:"append",subcategory:"vk",event:"b"});var a=r.querySelector("#mv_info"),o=a&&a.querySelector(".mv_actions_block .like_cont .like_btns");a=null;var s=function(e){return e?e.querySelector("#mv_top_controls, #VideoLayerInfo__topControls"):null},c=s(r);if(c||(c=s(r.closest("#mv_container"))),o&&ce.elIsHidden(o)&&(o=null),o||c){for(var d,p=!(o||!c),f=r.querySelectorAll(".savefrom_vk_download"),h=0;d=f[h];h++)d.parentNode.removeChild(d);d=null,f=null;var m=O.a.create("div",{class:["savefrom_vk_download","sf-under-video"],style:{cursor:"pointer"},on:[["click",function(){var a=Object(i.a)(l.a.mark((function a(o){var i,s,c;return l.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(c=function(e){return e.map((function(e){return e.href=e.url,e.title=e.filename,delete e.url,delete e.filename,e}))},o.stopPropagation(),x.a.onRemoveEvent(this,re.hideMenu),!re.contextMenu||!re.contextMenu.isShow){a.next=6;break}return re.hideMenu(),a.abrupt("return");case 6:return i=re.contextMenu=n.popupMenu.quickInsert(this,u.a.i18n.getMessage("download")+"...","sf-single-video-menu",{parent:r}),a.next=9,K.a.createLinkExtractor("vk-video").extractLinks({element:e,initData:t});case 9:return s=a.sent,a.abrupt("return",i.update(c(s)));case 11:case"end":return a.stop()}}),a,this)})));return function(e){return a.apply(this,arguments)}}()],["mousedown",function(e){e.stopPropagation()}],["keydown",function(e){e.stopPropagation()}]]});if(o){O.a.create(m,{class:["like_btn"],append:[O.a.create("div",{class:["like_button_icon"],append:[O.a.create("img",{src:n.svg.getSrc("download","#828a99"),width:16,height:16,style:{margin:"4px"}})]}),O.a.create("div",{class:["like_button_label"],text:u.a.i18n.getMessage("download")})]});var v=o.querySelector(".ui_actions_menu_wrap");v?v.parentNode.insertBefore(m,v):o.appendChild(m)}else if(p){O.a.create(m,{class:["mv_top_button"],style:{textAlign:"center"},append:[O.a.create("img",{class:["mv_small_close_icon"],style:{backgroundImage:"none",width:"20px",height:"20px"},src:n.svg.getSrc("download","#FFFFFF"),width:20,height:20})]});var g=c.firstChild;if(g)if(ce.elIsHidden(c.lastChild)){for(;g.nextElementSibling&&!ce.elIsHidden(g.nextElementSibling);)g=g.nextElementSibling;g.parentNode.insertBefore(m,g)}else c.appendChild(m);else c.appendChild(m)}}}},newClipButton:function(e,r){setTimeout((function(){if(e){Object(X.a)({category:"append",subcategory:"vk",event:"b"});var a=r.closest(".ShortVideoPost");a||(a=r);var o=a.querySelector(".like_btns");o||(o=a.querySelector(".like_cont"));var s=r.closest("#mv_layer_wrap"),c=O.a.create("div",{id:"savefrom__yt_btn",style:{display:"flex",marginLeft:"10px",verticalAlign:"middle"},append:[O.a.create("a",{class:"sf-quick-dl-btn",href:"javascript:void(0)",style:{display:"inline-block",fontSize:"inherit",height:"22px",border:"1px solid #00B75A",borderRadius:"3px",borderTopRightRadius:0,borderBottomRightRadius:0,paddingLeft:"28px",cursor:"pointer",verticalAlign:"middle",position:"relative",lineHeight:"22px",textDecoration:"none",zIndex:1,color:"#fff",marginRight:"8px"},append:[O.a.create("i",{style:{position:"absolute",display:"inline-block",left:"6px",top:"3px",backgroundImage:"url("+n.svg.getSrc("download","#ffffff")+")",backgroundSize:"12px",backgroundRepeat:"no-repeat",backgroundPosition:"center",width:"16px",height:"16px"}})],on:[["click",function(){var r=Object(i.a)(l.a.mark((function r(a){var i,u,c;return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(u=function(e){return e.map((function(e){return e.href=e.url,e.title=e.filename,delete e.url,delete e.filename,e}))},a.stopPropagation(),x.a.onRemoveEvent(this,re.hideMenu),!re.contextMenu||!re.contextMenu.isShow){r.next=6;break}return re.hideMenu(),r.abrupt("return");case 6:return re.contextMenu=n.popupMenu.quickInsert(this,"Скачивается...","sf-single-video-menu",{parent:o},"clip"),r.next=9,K.a.createLinkExtractor("vk-clip").extractLinks({element:e,initData:t});case 9:if(i=r.sent,0===(c=u(i)).length){r.next=15;break}this.href=ae(c),r.next=17;break;case 15:return this.href=s.querySelector("video").src,r.abrupt("return",Object(M.a)({action:"downloadVkStory",downloadFileUrl:this.href,fileName:"".concat(Date.now(),".mp4")}));case 17:this.click(),this.href="javascript:void(0)",a.preventDefault();case 20:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}()]]}),O.a.create("style",{text:Object(g.a)({selector:"#savefrom__yt_btn",append:[{"button::-moz-focus-inner":{padding:0,margin:0},".sf-quick-dl-btn":{backgroundColor:"#00B75A"},".sf-quick-dl-btn:hover":{backgroundColor:"rgb(0, 163, 80)"},".sf-quick-dl-btn:active":{backgroundColor:"rgb(0, 151, 74)"}},{media:"@media screen and (max-width: 1293px)",append:{".sf-quick-dl-btn .sf-btn-name":{display:"none"}}}]})}),O.a.create("button",{style:{position:"relative",display:"inline-block",marginLeft:"-2px",fontSize:"inherit",height:"24px",paddingRight:"21px",backgroundColor:"#F8F8F8",border:"1px solid #CCCCCC",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",cursor:"pointer",color:"#9B9B9B",zIndex:0,verticalAlign:"middle",boxSizing:"border-box",lineHeight:"22px"},on:[["click",function(){var r=Object(i.a)(l.a.mark((function r(a){var i,s,c,d;return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(c=function(e){return e.map((function(e){return e.href=e.url,e.title=e.filename,delete e.url,delete e.filename,e}))},a.stopPropagation(),x.a.onRemoveEvent(this,re.hideMenu),!re.contextMenu||!re.contextMenu.isShow){r.next=6;break}return re.hideMenu(),r.abrupt("return");case 6:return i=re.contextMenu=n.popupMenu.quickInsert(this,u.a.i18n.getMessage("download")+"...","sf-single-video-menu",{parent:o},"clip"),r.next=9,K.a.createLinkExtractor("vk-clip").extractLinks({element:e,initData:t});case 9:return s=r.sent,d=c(s),r.abrupt("return",i.update(d));case 12:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}()],["mousedown",function(e){e.stopPropagation()}],["keydown",function(e){e.stopPropagation()}]],append:[O.a.create("i",{style:{position:"absolute",display:"inline-block",top:"9px",right:"6px",border:"5px solid #868282",borderBottomColor:"transparent",borderLeftColor:"transparent",borderRightColor:"transparent"}}),O.a.create("span",{text:"HD"})]})]});o&&(o.querySelector("#savefrom__yt_btn")||o.append(c))}}),500)},appendNewFrameBtn:function(e,t){var a=this;if(!t.querySelector(".savefrom_vk_download")){var o=n.frameMenu.getBtn({singleBtn:!0,btnId:a.btnBoxId,containerStyle:{top:"10px",right:"10px"},on:[["click",function(t){if(t.preventDefault(),t.stopPropagation(),re.contextMenu&&re.contextMenu.isShow)re.hideMenu();else{var i=re.contextMenu=n.frameMenu.getMenu(this,u.a.i18n.getMessage("download")+"...","sf-frame-menu",{container:o.container,onShow:function(){o.node.classList.add("sf-over")},onHide:function(){re.contextMenu=null,o.node.classList.remove("sf-over")}});if(e.request){var s=function(t){var o=u.a.i18n.getMessage("noLinksFound");if(t&&"getPladformVideo"===e.request.action)o=r.showUmmyItem&&"getRutubeLinks"===t.action?n.popupMenu.prepareLinks.rutube(t.links):a.prepareLinks(a.preparePladformLinks(t));else if(t&&t.links){var s=n.embedDownloader.reMapHosting(t.action);s&&(o=n.popupMenu.prepareLinks[s](t.links,t.title))}i.update(o)};try{u.a.sendMessage(e.request,s)}catch(t){s()}}else i.update(a.prepareLinks(e));!1}}],["mousedown",function(e){e.stopPropagation(),2===e.button&&(re.hideMenu(),o.container.parentNode&&o.container.parentNode.removeChild(o.container))}]]});o.container=O.a.create("div",{class:"sf-btn-ctr",append:o.node}),o.node.appendChild(O.a.create("style",{text:Object(g.a)([{selector:["body:hover .sf-btn-ctr #"+a.btnBoxId,"body:hover .sf-btn-ctr .sf-frame-menu"],style:{display:"block"}}])})),document.body.appendChild(o.container)}},addFrameBtn:function(){var e=document.getElementById("page_wrap");e&&de.getLinksFromFrame((function(t,n){t||de.appendNewFrameBtn(n,e)}))}},pe={linkDataAttr:"savefromHasBtn",getLinkAsAjaxRequest:function(e,t){t=t||0;var n=Object.assign({},e),r=function(){if(t<1)return pe.getLinkAsAjaxRequest(e,++t);e.error&&e.error()},a=n.data;0===t?a.act="show_inline":1===t&&(a.act="show"),Object(w.a)(n,(function(t,n,a){return t||!a||-1!==a.indexOf('href="/join"')?r():void e.success(a)}))},getVideoDataFromLink:function(e){var t=e.getAttribute("onclick"),n=/showVideo\(['"]{1}([^'"]+)['"]{1},.?['"]{1}([^'"]+)['"]{1},.*\)/.exec(t);return n&&n.shift(),n},getLinkAsAjax:function(e,t,a){pe.getLinkAsAjaxRequest({localXHR:1,type:"POST",url:"/al_video.php",data:{list:e[1],video:e[0],act:"show_inline",module:a,al:1},success:function(e){if(!e)return t();var a=e.match(/<iframe[^>]+src=['"]{1}([^'">]+)['"]{1}[^>]+>/i);if(a||(a=e.match(/var\s+opts\s+=\s+({[^}]*})/im))&&(a=a[1].match(/url:\s+['"]{1}([^'"]+)['"]{1}/i))&&0!==a[1].indexOf("//")&&0!==a[1].indexOf("http")&&(a=null),a){var o=a[1];if(r.showUmmyItem&&de.isRutubeLink(o))return t(de.getRutubeLinks(o));if(0===o.indexOf("//")&&(o="http:"+o),0!==o.indexOf("http"))return t();var i=n.embedDownloader.checkUrl(o);if(!i)return t();var s={action:i.action,extVideoId:i.extVideoId};u.a.sendMessage(s,(function(e){var r=i.hosting;return e.action!==s.action&&(r=n.embedDownloader.reMapHosting(e.action)),t(e,r)}))}else Object(M.a)({action:"getVkLinksFromData",data:e}).then((function(e){return t(e,"vk")})).catch((function(){return t({},"vk")}))},error:function(){t()}})},addDownloadBtn:function(e){var t=e.href,r={display:"inline-block",width:"16px",height:"16px",marginLeft:"5px",backgroundImage:"url("+n.svg.getSrc("download","#78A2CC")+")",backgroundRepeat:"no-repeat",marginBottom:"-4px"},a=O.a.create("a",{href:"http://savefrom.net/?url="+encodeURIComponent(t),style:r,on:["click",function(e){if(e.preventDefault(),x.a.onRemoveEvent(o,re.hideMenu),re.contextMenu&&re.contextMenu.isShow)re.hideMenu();else{var t=document.querySelector("#wk_box");t&&t.contains(this)||(t=null);var r={parent:t},i=this.getAttribute(n.embedDownloader.dataAttr),s=n.embedDownloader.checkUrl(i);if(s){var l={action:s.action,extVideoId:s.extVideoId},c=re.contextMenu=n.popupMenu.quickInsert(a,u.a.i18n.getMessage("download")+" ...","sf-popupMenu",r);de.prepareVideoLinks(l).then((function(e){e.map((function(e){return"MP4"===e.format&&(e.forceDownload=!0),e})),c.update(e)}))}else re.contextMenu=n.popupMenu.quickInsert(a,u.a.i18n.getMessage("noLinksFound"),"sf-popupMenu",r)}}]});a.setAttribute(n.embedDownloader.dataAttr,t);var o=O.a.create("span",{class:"sf-video-feed-container",on:["click",function(e){e.stopPropagation()}],append:[a]}),i=e.querySelector(".post_video_title");i?i.appendChild(o):e.appendChild(o)},onLinkHover:function(){if("A"===this.tagName){var e=this.href||"";0===this.id.indexOf("post_media_lnk")&&-1!==e.indexOf("/video")&&(re.contextMenu&&re.contextMenu.isShow&&re.hideMenu(),this.dataset[pe.linkDataAttr]||(this.dataset[pe.linkDataAttr]=1,pe.addDownloadBtn(this)))}},off:function(){for(var e,t=document.querySelectorAll(".sf-video-feed-container"),n=0;e=t[n];n++)e.parentNode.removeChild(e);var r=Object(m.a)(pe.linkDataAttr),a=document.querySelectorAll("*["+r+"]");for(n=0;e=a[n];n++)e.removeAttribute(r)}},fe={photoCache:{},getAlbumId:function(e){if(!/(\?|&|#)act=edit/i.test(e)){var t=[];t.push(e);var n=Object(h.a)(e);n.w&&t.push(n.w),n.z&&t.push.apply(t,n.z.split("/")),/#/.test(e)&&(t.push(e.substr(e.indexOf("#")+1)),t.push(decodeURIComponent(e.substr(e.indexOf("#")+1)))),t.reverse();var r=null,a=null;return t.some((function(e){if(a=e.match(/(?:\/|#|=|^)(albums?|tag|photos|feed(?:\d+)?_|wall)(-?\d+)(?:_(\d+))?/i))return a[3]?r=/^(feed|wall)/.test(a[1])?a[1]+a[2]+"_"+a[3]:"album"+a[2]+"_"+a[3]:("albums"==a[1]&&(a[1]="photos"),r=a[1]+a[2]),!0})),r}},getModuleName:function(e){var t=O.a.create("script",{text:"("+'function(){if(window.cur&&window.cur.module&&typeof window.cur.module==="string"){document.body.dataset["{dataArg}"]=window.cur.module}}'.replace("{dataArg}","sfModule")+")();"});document.body.appendChild(t),setTimeout((function(){t.parentNode.removeChild(t),e(document.body.dataset.sfModule)}),0)},isReply:function(e){return Object(b.a)(e,".replies "+e.tagName)||Object(b.a)(e,".wl_replies "+e.tagName)},getPopup:function(e,t,r){var a,o=n.playlist.getInfoPopupTemplate();O.a.create(o.textContainer,{append:[O.a.create("p",{text:e,style:{color:"#0D0D0D",fontSize:"20px",marginBottom:"11px",marginTop:"13px"}}),a=O.a.create("p",{text:"",style:{color:"#868686",fontSize:"14px",lineHeight:"24px"}})]});var i=n.popupDiv(o.body,"sf_progress_popup",void 0,void 0,r),s=function e(n){e.state!==n&&(e.state=n,o.buttonContainer.style.display="none",a.style.display="none",u.a.sendMessage({action:"getWarningIcon",type:t,color:"#77D1FA"},(function(e){o.icon.style.backgroundImage="url("+e+")"})),"progress"===n&&(a.style.display="block"),"error"===n&&(u.a.sendMessage({action:"getWarningIcon",type:t,color:"#AAAAAA"},(function(e){o.icon.style.backgroundImage="url("+e+")"})),a.style.display="block"))};return{onPrepare:function(e){s("progress"),a.textContent=e},onProgress:function(e,t){a.textContent=u.a.i18n.getMessage("vkFoundFiles").replace("%d",e)+" "+u.a.i18n.getMessage("vkFoundOf")+" "+t},onReady:function(){x.a.trigger(i,"kill")},onError:function(e){s("error"),a.textContent=e}}},getLayer:function(){var e=document.getElementById("layer_wrap");return null!==e&&"none"!==e.style.display&&0!==e.textContent.length||(e=null),null===e&&(null!==(e=document.getElementById("wk_layer_wrap"))&&"none"!==e.style.display&&0!==e.textContent.length||(e=null)),e},_getModuleName:function(){return new Promise((function(e,t){var n=O.a.create("script",{text:'(function(dataArg){if(window.cur&&window.cur.module&&typeof window.cur.module==="string"){document.body.dataset[dataArg]=window.cur.module}})('+JSON.stringify("sfModule")+");"});document.body.appendChild(n),setTimeout((function(){n.parentNode.removeChild(n),e(document.body.dataset.sfModule)}),0)}))},_getLinks:(z=Object(i.a)(l.a.mark((function e(t){var r,a,o,i,s,c;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,a=Promise.resolve(),o={},i=r.getPopup(se(),"photo",(function(){o.abort=!0})),o.onProgress=function(e,t){i.onProgress(e,t)},i.onPrepare(u.a.i18n.getMessage("download")+" ..."),e.prev=6,e.next=9,K.a.createLinkExtractor("vk-albums").extractLinks({mediaId:t,details:o});case 9:s=e.sent,i.onReady(),c=se(),d?n.downloadList.showBeforeDownloadPopup(s,{count:s.length,folderName:c,type:"photo",onShowList:function(){r.showListOfLinks(c,s,!0)}}):r.showListOfLinks(c,s,!0),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),"Abort"!==e.t0.message&&Z.debug("_getLinks error",e.t0),i.onError(u.a.i18n.getMessage("noLinksFound"));case 19:return e.abrupt("return",a);case 20:case"end":return e.stop()}}),e,this,[[6,15]])}))),function(e){return z.apply(this,arguments)}),rmPhotoAlbumDlBtn:function(){for(var e,t=document.querySelectorAll([".sf-dl-ablum-btn-divide",".sf-dl-ablum-btn"]),n=0;e=t[n];n++)e.parentNode.removeChild(e)},addNewPhotoAlbumDlBtn:function(e){var t=this,n=e.querySelector(".photos_album_intro_info"),r=e.querySelector(".page_block_header_extra"),a=n||r;if(a&&!a.querySelector(".sf-dl-ablum-btn")){var o=O.a.create("a",{text:u.a.i18n.getMessage("vkDownloadPhotoAlbum"),href:"#",class:"sf-dl-ablum-btn",on:["click",function(e){e.preventDefault();var n=fe.getAlbumId(location.href);t._getLinks(n)}]}),i=O.a.create("span",{append:o});n?(i.classList.add("photos_album_info"),i=O.a.create(document.createDocumentFragment(),{append:[O.a.create("span",{class:"divide sf-dl-ablum-btn-divide",text:"|"}),i]})):r&&(i.classList.add("photos_comments_link"),i.style.margin="0 15px"),a.appendChild(i)}},getContainer:function(){var e=document.getElementById("photos_albums_container");return e||(e=document.getElementById("photos_container")),e},rmCurrentPhotoBtn:function(e){for(var t,n=void 0,r=document.querySelectorAll(".sf-dl-current-photo-btn"),a=0;t=r[a];a++)e&&e.contains(t)?n=t:t.parentNode.removeChild(t);return n},style:null,injectStyle:function(){this.style?this.style.parentNode||document.head.appendChild(this.style):(this.style=O.a.create("style",{text:Object(g.a)({"div > .sf-dl-current-photo-btn":{display:"none",border:"1px solid #F8F8F8",width:"20px",height:"20px",padding:0,position:"absolute",background:"url("+n.svg.getSrc("download","#777777")+") center no-repeat #F8F8F8",backgroundSize:"12px",top:"20px",left:"30px",zIndex:10,cursor:"pointer"},"div > .sf-dl-current-photo-btn.sf-style-black":{border:0,background:"url("+n.svg.getSrc("download","#FFF")+") center no-repeat #000",backgroundSize:"14px",padding:"2px 4px",borderRadius:"2px",opacity:.4,transition:"opacity 100ms linear"},"div > .sf-dl-current-photo-btn:hover":{background:"url("+n.svg.getSrc("download","#00B75A")+") center no-repeat #F8F8F8",backgroundSize:"12px",opacity:.8},"div > .sf-dl-current-photo-btn.sf-style-black:hover":{background:"url("+n.svg.getSrc("download","#00B75A")+") center no-repeat #000",backgroundSize:"14px"},"div > .sf-dl-current-photo-btn:active":{outline:0,boxShadow:"inset 0 3px 5px rgba(0, 0, 0, 0.125)"},"div:hover > .sf-dl-current-photo-btn":{display:"block"}})}),document.head.appendChild(this.style))},getMaxPhotoSize:function(e){var t=null,n=null;["w","z","y","x"].some((function(r){return!!(t=e[r+"_"])||(!!(n=e[r+"_src"])||void 0)})),t||(t=[n]);var r,a;return t[0]?{url:(r=e.base,a=t[0],a.match(/https?:\/\//i)?((a=new URL(a)).pathname.match(/\.[a-z]{3}$/i)||(a+=".jpg"),a.toString()):(a.match(/\.[a-z]{3}$/i)||(a+=".jpg"),(r||"").replace(/\/[a-z0-9_:\.]*$/i,"")+"/"+a)),width:t[2]&&t[1],height:t[1]&&t[2]}:null},addNewDlCurrentPhotoBtn:function(e){var t=e;if(Object(X.a)({category:"append",subcategory:"vk",event:"b"}),!this.rmCurrentPhotoBtn(t)){var r=e.closest(".pv_photo_wrap");if(r){var a=O.a.create("a",{class:["sf-dl-current-photo-btn","sf-style-black"],href:"#",title:u.a.i18n.getMessage("download"),on:[["click",function(){var e=Object(i.a)(l.a.mark((function e(a){var i,s,c,d,p,f,h,m;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.stopPropagation(),a.preventDefault(),x.a.onRemoveEvent(this,re.hideMenu),!re.contextMenu||!re.contextMenu.isShow){e.next=6;break}return re.hideMenu(),e.abrupt("return");case 6:return i=re.contextMenu=n.popupMenu.quickInsert(this,u.a.i18n.getMessage("download")+" ...","photoDlMenu",{parent:t}),s=function(){return i.update(u.a.i18n.getMessage("noLinksFound"))},c=r.querySelector(".like_wrap").classList,d=null,c.forEach((function(e){var t=e.match(/photo(-?\d+_\d+)/);d=t&&t[1]})),e.prev=11,e.next=14,K.a.createLinkExtractor("vk-photo").extractLinks({mediaId:d});case 14:p=e.sent,f=Object(o.a)(p,1),h=f[0],(m=[]).push({href:h.url,title:h.filename,quality:u.a.i18n.getMessage("download"),format:" ",ext:h.ext,forceDownload:!0,isOther:!0,isBlank:!0,func:function(){"undefined"!=typeof GM_info&&"Tampermonkey"===GM_info.scriptHandler?setTimeout((function(){return i.hide()}),2500):i.hide()}}),m.push({href:"#getAlbum",title:"",quality:u.a.i18n.getMessage("vkDownloadPhotoAlbum"),format:" ",ext:"",noSize:!0,isOther:!0,func:function(e){e.preventDefault(),fe.downloadPhoto(),i.hide()}}),i.update(m),e.next=27;break;case 23:return e.prev=23,e.t0=e.catch(11),console.error(e.t0),e.abrupt("return",s());case 27:case"end":return e.stop()}}),e,this,[[11,23]])})));return function(t){return e.apply(this,arguments)}}()],["mousedown",function(e){e.stopPropagation()}]]});new P.a({queries:[{css:"#pv_photo img",is:"added",callback:function(){re.contextMenu&&re.contextMenu.isShow&&(re.hideMenu(),a.click())}}]}),t.appendChild(a)}}},downloadPhoto:function(){var e=this.getAlbumId(location.href);if(!e){var t=document.querySelector(".pv_album_name a");t&&!ce.elIsHidden(t)&&(e=this.getAlbumId(t.href))}this._getLinks(e)},showListOfPhotosContent:function(e,t){var n;return"<!DOCTYPE html><html>"+O.a.create("html",{append:[O.a.create("head",{append:[O.a.create("meta",{attr:{charset:"utf-8"}}),O.a.create("style",{text:"a,img{display:block;margin-bottom:5px;}p{width: 640px}"})]}),O.a.create("body",{append:[e,O.a.create("p",{text:u.a.i18n.getMessage("vkListOfPhotosInstruction")}),O.a.create("br"),O.a.create("br"),(n=document.createDocumentFragment(),t.forEach((function(e){var t=e.url,r=e.filename||"",a=O.a.create("img",{src:t,alt:"photo"});r&&(a=O.a.create("a",{href:t,download:r,append:a})),n.appendChild(a)})),n)]})]}).innerHTML+"</html>"},showListOfLinks:function(e,t,r){var a;a=r?O.a.create(document.createDocumentFragment(),{append:[O.a.create("p",{append:[O.a.create("a",{text:u.a.i18n.getMessage("vkListOfPhotos"),href:"#",class:"sf__hidden",style:{fontWeight:"bolder",border:"none",textDecoration:"underline"},on:["click",function(n){n.preventDefault();var r=fe.showListOfPhotosContent(e,t),a="";u.a.isChrome||u.a.isTM?(a=Object(y.a)(r,"text/html",!0),u.a.sendMessage({action:"openTab",url:a})):(a=Object(y.a)(r,"text/html"),window.open(a,"_blank"))}]})]})]}):"";for(var o,i,s="",l=0;o=t[l];l++)s+=o.url+"\r\n";var c=O.a.create(document.createDocumentFragment(),{append:[O.a.create("p",{text:e,style:{color:"#0D0D0D",fontSize:"20px",marginBottom:"11px",marginTop:"5px"}}),O.a.create("p",{append:Object(S.a)(u.a.i18n.getMessage("vkListOfLinksInstruction"))}),a,i=O.a.create("textarea",{text:s,cols:60,rows:10,style:{width:"100%"}}),u.a.isChrome||u.a.isFirefox?O.a.create("button",{text:u.a.i18n.getMessage("copy"),style:{height:"27px",backgroundColor:"#ffffff",border:"1px solid #9e9e9e",marginTop:"6px",paddingLeft:"10px",paddingRight:"10px",borderRadius:"5px",fontSize:"14px",cursor:"pointer",cssFloat:"right"},on:["click",function(e){var t=this;t.disabled=!0,u.a.isFirefox?(i.select(),document.execCommand("copy")):u.a.sendMessage({action:"addToClipboard",text:s}),setTimeout((function(){t.disabled=!1}),1e3)}],append:O.a.create("style",{text:Object(g.a)({"#savefrom_popup_box button:hover:not(:disabled)":{backgroundColor:"#597A9E !important",borderColor:"#597A9E !important",color:"#fff"},"#savefrom_popup_box button:active":{opacity:.9}})})}):void 0]});n.popupDiv(c)}},he={mobileMenu:null,observer:null,styleEl:null,run:function(){var e=this;if(P.a.isAvailable()){if(e.observer)return e.observer.start();e.observer=new P.a({queries:[{css:"div.audio_item",is:"added",callback:function(t){for(var n,r=0;n=t.added[r];r++)n.dataset.sfSkip>0||(n.dataset.sfSkip="1",e.insertAudioBtn(n))}},{css:"div.VideoPage",is:"added",callback:function(t){for(var n,r=0;n=t.added[r];r++)n.dataset.sfSkip>0||(n.dataset.sfSkip="1",e.insertVideoBtn(n))}},{css:"."+x.a.onRemoveClassName,is:"removed",callback:function(e){for(var t,n=0;t=e.removed[n];n++)x.a.onRemoveListener(t)}}]}),e.insertStyle()}},hideMenu:function(){he.mobileMenu&&(he.mobileMenu.hide(),he.mobileMenu=null)},insertStyle:function(){this.styleEl?this.styleEl.parentNode||document.head.appendChild(this.styleEl):(this.styleEl=O.a.create("style",{class:"sf-style",text:Object(g.a)([{selector:".savefrom_vk_download.sf-audio",style:{display:"block",float:"right",borderRadius:"3px",width:"22px",height:"22px",marginTop:"1px",marginLeft:"3px",marginRight:"3px",background:"url("+n.svg.getSrc("download","#ffffff")+") center no-repeat",backgroundSize:"12px",backgroundColor:"#5E80AA"}},{selector:".audio_item .savefrom_vk_download.sf-audio",style:{position:"absolute",right:"32px",top:0,bottom:0,margin:"auto"}},{selector:".audio_item.ai_current .savefrom_vk_download.sf-audio",style:{bottom:"auto",top:"6px"}}])}),document.head.appendChild(this.styleEl))},getAudioUrlFromNode:(G=Object(i.a)(l.a.mark((function e(t){var n,r,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ce.getNewNodeTrackInfo(t);case 2:if((n=e.sent).fullId&&n.actionHash&&n.urlHash){e.next=5;break}throw new Error("Track info not valid for fetch audio link");case 5:return r=ce.requestReloadAudio(n.fullId,n.actionHash,n.urlHash),a=Object(D.a)([],"function(){return vk.id}"),e.abrupt("return",Promise.all([r,a]).then((function(e){var t=Object(o.a)(e,2),n=t[0],r=t[1],a=I.a(r,n.url);return I.b(a)?I.c(a):a})));case 8:case"end":return e.stop()}}),e)}))),function(e){return G.apply(this,arguments)}),onAudioBtnClick:function(e){if(e.preventDefault(),e.stopPropagation(),e.target.href)return n.downloadOnClick(e);var t=e.target.closest(".audio_item");t&&this.getAudioUrlFromNode(t).then((function(t){e.target.href=t,n.downloadOnClick(e)})).catch((function(e){Z.error("getAudioUrlFromNode error: "+e.message)}))},getAudioDlBtnNode:function(e){return O.a.create("a",{class:["savefrom_vk_download","sf-audio"],download:L.a.modify(e),target:"_blank",on:["click",this.onAudioBtnClick.bind(this)],title:u.a.i18n.getMessage("download")})},insertAudioBtn:function(e){var t=null,n=e.querySelector(".ai_label");if(n){var r=n.textContent.trim(),a=n.querySelector(".ai_title"),o=n.querySelector(".ai_artist"),i=a&&a.textContent.trim(),s=o&&o.textContent.trim();t=i&&s?"".concat(s.trim()," – ").concat(i.trim()):r}t="".concat(t||"unknown",".mp3");var l=e.querySelector(".ai_dur");if(l){var u=l.parentNode,c=this.getAudioDlBtnNode(t),d=u.querySelector(".savefrom_vk_download");if(d)d.parentNode.replaceChild(c,d);else{var p=l.nextElementSibling;if(!p)return;u.insertBefore(c,p)}}},onVideoBtnClick:function(e,t){t.preventDefault(),t.stopPropagation(),he.hideMenu();var r=he.mobileMenu=n.mobileLightBox.show(u.a.i18n.getMessage("download")+" ..."),a=u.a.i18n.getMessage("noLinksFound");if(e.request){var o=function(t){if(t&&"getPladformVideo"===e.request.action)a=de.prepareLinks(de.preparePladformLinks(t));else{var o=n.embedDownloader.reMapHosting(t.action);o&&t&&t.links&&(a=n.popupMenu.prepareLinks[o](t.links,t.title))}if(!a.length){var i=Array.from(document.body.querySelectorAll('.vv_inline_video source[type="video/mp4"]'));a=i.map((function(e){var t=document.querySelector(".VideoPageInfoRow__title"),n=e.src.match(/.(\d+)\.mp4/);return{title:t?t.textContent:"video",href:e.src,forceDownload:!0,ext:"mp4",format:"MP4",quality:n?n[1]:""}}))}r.update(a)};try{u.a.sendMessage(e.request,o)}catch(t){o()}}else a=de.prepareLinks(e),r.update(a)},appendVideoBtn:function(e,t){var r=t.querySelector(".VideoPageInfoRow__title"),a=n.svg.getSvg("download","#4986cc","20px");a.style.marginLeft="17px",a.style.marginTop="6px",a.style.float="right",a.style.cursor="pointer",a.addEventListener("click",this.onVideoBtnClick.bind(this,e)),r&&r.appendChild(a),x.a.onRemoveEvent(a,he.hideMenu)},insertVideoBtn:function(e){var t=this,n=e.querySelectorAll("iframe, video, a")[0],r=Object(f.a)(e,"VideoPage"),a=function(){var e=/video(-?\d+)_(-?\d+)/.exec(location.href);return e&&{request:{hosting:"vk",action:"getVKLinks",extVideoId:"video"+e[1]+"_"+e[2]}}};n?de.getLinksFromPlayer(r,n,(function(e,n){e||(e=a()),e&&t.appendVideoBtn(e,n)})):e.querySelector(".vv_not_support")&&a()&&t.appendVideoBtn(a(),r)}}}))}});