!function(e){function t(t){for(var r,i,c=t[0],s=t[1],u=t[2],d=0,f=[];d<c.length;d++)i=c[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&f.push(a[i][0]),a[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(l&&l(t);f.length;)f.shift()();return o.push.apply(o,u||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,c=1;c<n.length;c++){var s=n[c];0!==a[s]&&(r=!1)}r&&(o.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},a={15:0},o=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var c=window.savefromContentScriptWebpackJsonp=window.savefromContentScriptWebpackJsonp||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;o.push([119,0]),n()}({119:function(e,t,n){"use strict";n.r(t);var r=n(5),a=n(6),o=n(0),i=n(28),c=n(25),s=n(18),u=n(12),l=n(27),d=n(9),f=n(30),p=n(53);var v=function(e){return function(e){var t={operationName:"PlaybackAccessToken_Template",variables:{vodID:e,login:"",isLive:!1,isVod:!0,playerType:"site"},query:'query PlaybackAccessToken_Template($login: String!, $isLive: Boolean!, $vodID: ID!, $isVod: Boolean!, $playerType: String!) {\n  streamPlaybackAccessToken(\n    channelName: $login\n    params: {platform: "web", playerBackend: "mediaplayer", playerType: $playerType}\n  ) @include(if: $isLive) {\n    value\n    signature\n    __typename\n  }\n  videoPlaybackAccessToken(\n    id: $vodID\n    params: {platform: "web", playerBackend: "mediaplayer", playerType: $playerType}\n  ) @include(if: $isVod) {\n    value\n    signature\n    __typename\n  }\n}\n'};return Object(f.a)({url:"https://gql.twitch.tv/gql",method:"POST",headers:{"client-id":"kimne78kx3ncx6brgo4mv6wki5h1ko"},json:!0,data:JSON.stringify(t)}).then((function(t){if(!t.body||!t.body.data||!t.body.data.videoPlaybackAccessToken)throw new Error("Response not valid");var n=t.body.data.videoPlaybackAccessToken;if(!n.signature||!n.value)throw new Error("Signature or Value not found for video "+e);return n}))}(e).then((function(t){var n=t.signature,r=t.value,a="https://usher.ttvnw.net/vod/".concat(e,".m3u8?sig=").concat(n,"&supported_codecs=avc1&token=").concat(r,"&cdm=wv&player_version=0.9.80");return Object(f.a)(a)})).then((function(e){var t=new RegExp('(https.*?)\\n#EXT-X-MEDIA.*?NAME="(.*?)"',"g");return Object(p.a)(e.body,t).map((function(e){return{url:e[1],quality:parseInt(e[2])}}))}))},h=n(39),b=n(11),g=n(16),y=n(15),m=Object(u.a)("twitch"),k=void 0,w=function(){function e(){Object(r.a)(this,e),this._unmount=void 0,this._hasEvents=!1}return Object(a.a)(e,[{key:"start",value:function(){var e=this;m.log("start"),o.a.callFn("getPreferences").then((function(t){k=Object(g.a)({preferences:t}),e.preferences=t,e.isActive=Boolean(t.moduleTwitch),e._bindEvents(),t.moduleTwitch&&e._bindMutationWatcher()}))}},{key:"onFoundToolbar",value:function(e){var t=this;if(e||!e.parentElement){e=e.parentElement;var n={style:{background:"rgb(145, 71, 255)",padding:"5px 8px",borderRadius:"4px",paddingLeft:"10px",paddingRight:"11px",cursor:"pointer",marginLeft:"9px",marginRight:/\/clip\//.test(location.href)||document.querySelector('[data-a-target="login-button"]')?"60px":0,top:0,position:"absolute",left:"-49px"},href:"#",title:o.a.i18n.getMessage("download")};if(/videos\/\d+/.test(location.href))n.onClick=this.handleDownloadStream.bind(this);else{if(!/\/clip\//.test(location.href))return void m.error("media type not found");n.onClick=function(e){return t.handleDownloadClip(e)}}this._unmount=Object(l.a)(Object(d.e)("a",n,Object(d.e)("img",{src:k.svg.getSrc("download","#fff","8px"),style:{width:"14px",marginTop:"2px",opacity:.8}})),e)}}},{key:"handleDownloadStream",value:function(e){e.preventDefault(),e.stopPropagation();var t=location.href.match(/videos\/(\d+)/),n=t&&t[1]?t[1]:void 0,r=this.getVideoName();return v(n).then((function(e){var t=e.find((function(e){return e.quality<=720}));Object(l.a)(Object(d.e)(h.a,{filename:r,format:"mp4",sources:[{url:t.url,format:"mp4"}],convertType:"hls"}),"sf-muxer-parent")})).catch((function(t){m.error("handleDownloadStream err",t),e.target&&(e.target.style.opacity=.3,e.target.title="An error has occurred")}))}},{key:"handleDownloadClip",value:function(e){e.preventDefault(),e.stopPropagation(),Object(y.a)({category:"download",subcategory:"tw",event:"video"});var t=document.querySelector("video");if(t){var n=this.getVideoName();if(!k.download(n,t.src)){var r=document.createElement("a");r.href=t.src,r.download=n,r.target="_blank",r.click(),r.remove()}}}},{key:"getVideoName",value:function(){var e=document.querySelector('[data-a-target="stream-title"]'),t=e?e.textContent.split("â€¢")[0]:document.title;return b.a.modify(t)+".mp4"}},{key:"changeActive",value:function(e){m.log("change active",e),this.isActive=e?1:0,this.isActive?this.start():this._unmount&&this._unmount()}},{key:"_bindEvents",value:function(){var e=this;if(this._hasEvents)m.log("bind events skip");else{this._hasEvents=!0;var t,n=(t=[],o.a.onMessage.addListener((function(e,n,r){m.log("message",e);var a=t.find((function(t){var n=t.action;return e.action===n}));a&&a.handleCb(e,r)})),function(e,n){return t.push({action:e,handleCb:n})});n("getModuleInfo",(function(t,n){t.url===location.href&&n({moduleName:"twitch",state:e.isActive})})),n("changeState",(function(t){var n=t.moduleName,r=t.state;return"twitch"===n&&e.changeActive(r)})),n("updatePreferences",(function(t){var n=t.preferences;e.preferences=Object.assign(e.preferences,n)}))}}},{key:"_bindMutationWatcher",value:function(){var e=this;m.log("_bindMutationWatcher call"),this.observer&&(this.observer.stop(),this.observer.queries.forEach((function(e){var t=e.css;document.querySelectorAll(t).forEach((function(e){return function(e){return e.dataset.sfLock=""}(e)}))}))),this.observer=new s.a({queries:[{is:"added",css:'div[data-target="channel-header-right"] > div > div > div > div:nth-child(1)',callback:function(t){return t.added.forEach((function(t){var n,r;Object(y.a)({category:"append",subcategory:"tw",event:"b"}),n=t,r=e.onFoundToolbar.bind(e),n&&!n.dataset.sfLock&&(n.dataset.sfLock="1",r(n))}))}}]}),this.observer.start()}}]),e}();i.a.isSingle()&&Object(c.a)("twitch",(function(){(new w).start()}),(function(){return!0}))}});